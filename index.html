<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhereIs? - Location Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha525-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://static.neshan.org/sdk/leaflet/v1.9.4/neshan-sdk/v1.0.8/index.css"/>
  <script src="https://static.neshan.org/sdk/leaflet/v1.9.4/neshan-sdk/v1.0.8/index.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
  <script>
    tailwind.config = {
      darkMode: ['selector', '[data-theme="dark"]'],
      theme: {
        extend: {
          colors: {
            primary: '#1E40AF', // A strong, professional blue
            secondary: '#3B82F6', // A brighter, friendly blue for actions
            dark: '#111827', // Dark gray for text for better readability
            light: '#EFF6FF', // A very light blue for backgrounds
            accent: '#F59E0B', // An accent color for highlights if needed
          }
        }
      }
    }
  </script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.14.0"
  }
}
</script>
</head>

<body class="bg-gray-100 dark:bg-dark font-sans">

  <div id="app-container" class="container mx-auto p-4 md:p-6">
    <!-- Header -->
    <header class="flex justify-between items-center bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md gap-4">
      <div class="flex items-center gap-4 flex-grow">
        <h1 id="site-name-btn" class="text-3xl font-bold text-primary dark:text-secondary cursor-pointer" data-translate-key="site_name">WhereIs?</h1>
      </div>
      <div class="flex items-center gap-2 sm:gap-4 flex-shrink-0">
        <button id="theme-toggle-btn" class="text-primary dark:text-secondary text-2xl">
            <i class="fas fa-moon"></i>
        </button>
        <div class="relative" id="language-dropdown-container">
          <button id="language-dropdown-toggle" class="text-2xl px-2 py-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <span id="current-lang-flag">üáÆüá∑</span>
          </button>
          <div id="language-dropdown-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-1 z-50 border dark:border-gray-700">
            <button class="lang-btn w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3" data-lang="fa">
              <span class="text-xl">üáÆüá∑</span>
              <span>ŸÅÿßÿ±ÿ≥€å (Farsi)</span>
            </button>
            <button class="lang-btn w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3" data-lang="en">
              <span class="text-xl">üá¨üáß</span>
              <span>English</span>
            </button>
            <button class="lang-btn w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3" data-lang="ar">
              <span class="text-xl">üá∏üá¶</span>
              <span>ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</span>
            </button>
          </div>
        </div>
        <button id="user-icon-btn" class="text-primary dark:text-secondary text-2xl">
            <i class="fas fa-user"></i>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="mt-6">
      <!-- PAGE 1: LOCATION SELECTION -->
      <div id="page-location">
        <h2 class="text-2xl font-bold text-dark dark:text-white mb-6 text-center" data-translate-key="location_selection_title">Step 1: Choose a Location</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 pb-20">
          
          <!-- Card 1: Use My Location -->
          <div class="location-card">
            <i class="fas fa-location-arrow card-icon"></i>
            <div class="flex justify-center items-center gap-2">
              <h3 class="card-title" data-translate-key="use_my_location_title">Fastest Option</h3>
              <div class="relative group">
                  <i class="fas fa-info-circle text-gray-400 cursor-pointer"></i>
                  <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-10 mb-2 w-56 rounded-md bg-gray-800 p-2 text-center text-sm text-white opacity-0 transition-opacity group-hover:opacity-100 pointer-events-none" data-translate-key="fastest_way_desc">
                    Automatically detect your position using GPS for a quick start.
                  </span>
              </div>
            </div>
            <div class="flex-grow"></div> <!-- Spacer to push button down -->
            <button id="use-my-location-btn" class="card-button mt-auto">
              <i class="fas fa-location-arrow mr-2"></i>
              <span data-translate-key="use_my_location">Use My Current Location</span>
            </button>
          </div>

          <!-- Card 2: Select on Map -->
          <div class="location-card">
            <i class="fas fa-map-marked-alt card-icon"></i>
            <div class="flex justify-center items-center gap-2">
              <h3 class="card-title" data-translate-key="select_from_map_title">Select on the Map</h3>
              <div class="relative group">
                  <i class="fas fa-info-circle text-gray-400 cursor-pointer"></i>
                  <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-10 mb-2 w-56 rounded-md bg-gray-800 p-2 text-center text-sm text-white opacity-0 transition-opacity group-hover:opacity-100 pointer-events-none" data-translate-key="pick_on_map_desc">
                    Click directly on the map to choose your exact point of interest.
                  </span>
              </div>
            </div>
             <p id="location-status" class="text-center text-sm text-gray-600 dark:text-gray-400 my-2 h-5"></p>
            <div id="location-map" class="h-full min-h-[250px] bg-gray-200 dark:bg-gray-700 rounded-lg w-full mt-2 flex-grow">
               <p class="text-gray-500" data-translate-key="map_view_placeholder">Map will be shown here</p>
            </div>
          </div>
          
          <!-- Card 3: Select From List -->
          <div class="location-card">
            <i class="fas fa-list-ul card-icon"></i>
            <div class="flex justify-center items-center gap-2">
              <h3 class="card-title" data-translate-key="select_from_list_title">Select from a List</h3>
              <div class="relative group">
                <i class="fas fa-info-circle text-gray-400 cursor-pointer"></i>
                <span class="absolute bottom-full left-1/2 -translate-x-1/2 z-10 mb-2 w-56 rounded-md bg-gray-800 p-2 text-center text-sm text-white opacity-0 transition-opacity group-hover:opacity-100 pointer-events-none" data-translate-key="select_from_list_desc">
                  Browse through provinces, counties, and cities to pinpoint a location.
                </span>
              </div>
            </div>
            <div class="space-y-3 mt-4 flex-grow">
              <div>
                <label for="province-select" class="sr-only" data-translate-key="select_province"></label>
                <select id="province-select" class="w-full p-2 border rounded-md bg-gray-200 dark:bg-gray-700 dark:text-white dark:border-gray-600 cursor-not-allowed" disabled>
                  <option value="">--</option>
                </select>
              </div>
              <div>
                <label for="county-select" class="sr-only" data-translate-key="select_county"></label>
                <select id="county-select" class="w-full p-2 border rounded-md bg-gray-200 dark:bg-gray-700 dark:text-white dark:border-gray-600 cursor-not-allowed" disabled>
                  <option value="">--</option>
                </select>
              </div>
              <div>
                <label for="city-village-select" class="sr-only" data-translate-key="select_city_village"></label>
                <select id="city-village-select" class="w-full p-2 border rounded-md bg-gray-200 dark:bg-gray-700 dark:text-white dark:border-gray-600 cursor-not-allowed" disabled>
                  <option value="">--</option>
                </select>
              </div>
            </div>
            <p id="location-data-error" class="text-red-500 text-xs mt-2 text-center hidden"></p>
          </div>

        </div>
        <div class="action-bar flex justify-center">
          <button id="next-to-category-btn" class="bg-secondary hover:bg-primary text-white font-bold py-3 px-12 rounded-lg transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed transform disabled:scale-100 hover:scale-105 flex items-center gap-2 text-lg" disabled>
            <span data-translate-key="next">Next</span>
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- PAGE 2: CATEGORY SELECTION -->
      <div id="page-category" class="hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md pb-20">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-dark dark:text-white" data-translate-key="category_selection_title">Step 2: Select a Category</h2>
                <button id="back-to-main-categories-btn" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 hidden">
                    <i class="fas fa-arrow-left"></i>
                    <span data-translate-key="categories">Categories</span>
                </button>
            </div>
            
            <div class="mb-6 relative">
              <input type="search" id="quick-search-input" placeholder="Search for places (e.g., cafe, park)..." data-translate-key="search_placeholder" class="w-full bg-light dark:bg-gray-700 text-dark dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-lg py-3 pl-12 pr-4 text-base focus:outline-none focus:ring-2 focus:ring-secondary">
              <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                  <i class="fas fa-search text-gray-400 text-lg"></i>
              </div>
            </div>
            <p id="quick-search-error" class="text-red-500 text-xs -mt-4 mb-4 text-center hidden"></p>
            
            <div class="relative mb-6">
                <div class="absolute inset-0 flex items-center" aria-hidden="true">
                    <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
                </div>
                <div class="relative flex justify-center">
                    <span class="bg-white dark:bg-gray-800 px-3 text-base font-medium text-gray-500 dark:text-gray-400" data-translate-key="or_divider">
                    OR
                    </span>
                </div>
            </div>

            <div id="main-categories-view">
                <!-- Main categories icons populated by JS -->
            </div>
            <div id="sub-categories-view" class="hidden">
                 <!-- Sub categories icons populated by JS -->
            </div>
        </div>
        <div class="action-bar flex justify-between">
          <button id="back-to-location-btn" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-bold py-3 px-6 rounded-lg transition-colors flex items-center gap-2">
            <i class="fas fa-arrow-left"></i>
            <span data-translate-key="back">Back</span>
          </button>
          <button id="search-btn" class="bg-secondary hover:bg-primary text-white font-bold py-3 px-6 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2" disabled>
            <i class="fas fa-search"></i>
            <span data-translate-key="search">Search</span>
          </button>
        </div>
      </div>

      <!-- PAGE 3: RESULTS -->
      <div id="page-results" class="hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md pb-20 flex flex-col h-[calc(100vh-8rem)]">
          <h2 class="text-xl font-bold text-dark dark:text-white mb-4" data-translate-key="results_title">Step 3: Discover Places</h2>
          
          <!-- Map Container -->
          <div id="results-map" class="h-[40%] flex-shrink-0 bg-gray-200 dark:bg-gray-700 rounded-lg">
              <!-- Results map shown here -->
          </div>

          <!-- Tabs -->
          <div id="results-tabs" class="flex border-b dark:border-gray-700 mt-4">
            <button id="sort-nearest-btn" class="results-tab" data-translate-key="nearest">Nearest</button>
            <button id="sort-best-btn" class="results-tab" data-translate-key="best">Best</button>
          </div>

          <!-- List Container -->
          <div id="results-list" class="flex-1 overflow-y-auto mt-4 space-y-4 pr-2">
              <!-- Results populated here -->
          </div>

        </div>
        <div class="action-bar flex justify-between">
            <button id="back-to-category-btn" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-bold py-3 px-6 rounded-lg transition-colors flex items-center gap-2">
              <i class="fas fa-arrow-left"></i>
              <span data-translate-key="back">Back</span>
            </button>
            <button id="new-search-btn" class="bg-secondary hover:bg-primary text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center gap-2">
                <i class="fas fa-redo"></i>
                <span data-translate-key="new_search">New Search</span>
            </button>
          </div>
      </div>

    </main>
    
    <!-- Footer -->
    <footer class="text-center p-4 mt-4 text-sm text-gray-500 dark:text-gray-400 border-t dark:border-gray-700">
      <div class="flex justify-center items-center gap-4">
        <button id="about-us-btn" class="hover:text-secondary dark:hover:text-secondary transition-colors" data-translate-key="about_us">About Us</button>
        <span class="text-gray-300 dark:text-gray-600">|</span>
        <button id="faq-btn" class="hover:text-secondary dark:hover:text-secondary transition-colors" data-translate-key="faq">FAQ</button>
      </div>
    </footer>
  </div>
  
  <!-- Navigation Modal -->
  <div id="nav-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden">
    <div id="nav-modal-content" class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-11/12 max-w-xs text-center transform transition-all">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-dark dark:text-white" data-translate-key="navigate_with">Navigate with...</h3>
            <button id="nav-modal-close" class="text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-white text-2xl leading-none">&times;</button>
        </div>
        <div class="space-y-4">
            <a id="nav-neshan-link" href="#" target="_blank" class="nav-provider-link bg-light dark:bg-gray-700 hover:bg-blue-100 dark:hover:bg-gray-600">
                <img src="https://neshan.org/wp-content/uploads/2024/01/Asset-51x-1.svg" alt="Neshan Logo" class="w-10 h-10">
                <span class="text-lg font-semibold text-dark dark:text-white" data-translate-key="navigate_neshan">Neshan</span>
                <i class="fas fa-chevron-right text-gray-400 dark:text-gray-500"></i>
            </a>
            <a id="nav-google-link" href="#" target="_blank" class="nav-provider-link bg-light dark:bg-gray-700 hover:bg-blue-100 dark:hover:bg-gray-600">
                 <img src="https://developers.google.com/static/maps/images/maps-icon.svg" alt="Google Maps Logo" class="w-10 h-10">
                <span class="text-lg font-semibold text-dark dark:text-white" data-translate-key="navigate_google">Google Maps</span>
                <i class="fas fa-chevron-right text-gray-400 dark:text-gray-500"></i>
            </a>
        </div>
    </div>
  </div>


  <!-- Login Modal -->
  <div id="login-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-8 w-11/12 max-w-sm text-left relative login-card">
        <button id="login-modal-close" class="absolute top-2 right-4 text-2xl text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white">&times;</button>
        <h3 class="text-xl font-bold mb-6 text-dark dark:text-white text-center" data-translate-key="login_title">Login / Register</h3>
        <form id="login-form" class="space-y-4">
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-translate-key="username">Username</label>
                <input type="text" id="username" placeholder="Username" class="mt-1 w-full p-3 border dark:border-gray-600 rounded-md focus:ring-primary focus:border-primary bg-white dark:bg-gray-700 dark:text-white">
            </div>
            <div>
                 <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-translate-key="password">Password</label>
                <input type="password" id="password" placeholder="Password" class="mt-1 w-full p-3 border dark:border-gray-600 rounded-md focus:ring-primary focus:border-primary bg-white dark:bg-gray-700 dark:text-white">
            </div>
            <div>
                 <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-translate-key="email">Email Address</label>
                <input type="email" id="email" placeholder="Email" class="mt-1 w-full p-3 border dark:border-gray-600 rounded-md focus:ring-primary focus:border-primary bg-white dark:bg-gray-700 dark:text-white">
            </div>
            <div class="flex gap-4 pt-2">
                <button type="button" class="flex-1 card-button" data-translate-key="login">Login</button>
                <button type="button" id="register-btn" class="flex-1 bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500" data-translate-key="register">Register</button>
            </div>
            <p id="register-message" class="text-sm text-secondary font-semibold text-center pt-2 hidden"></p>
        </form>
    </div>
  </div>

  <!-- Image Gallery Modal -->
  <div id="image-gallery-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden">
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4 w-11/12 max-w-2xl text-center relative transform transition-all">
          <button id="gallery-modal-close" class="absolute top-2 right-4 text-3xl text-gray-300 hover:text-white">&times;</button>
          <div id="gallery-content" class="flex items-center justify-center h-96">
              <p class="text-gray-600 dark:text-gray-300" data-translate-key="no_images_available">No images available for this location.</p>
          </div>
      </div>
  </div>

  <!-- About Us Modal -->
  <div id="about-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-11/12 max-w-sm text-center relative">
      <button id="about-modal-close" class="absolute top-2 right-4 text-2xl text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-white">&times;</button>
      <h3 class="text-xl font-bold text-dark dark:text-white mb-4" data-translate-key="about_us">About Us</h3>
      <p class="text-gray-700 dark:text-gray-300 text-left" data-translate-key="about_us_text">Made by Mustafa with the help of AI ‚ù§Ô∏è</p>
    </div>
  </div>

  <!-- FAQ Modal -->
  <div id="faq-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-11/12 max-w-lg relative">
      <button id="faq-modal-close" class="absolute top-3 right-5 text-2xl text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-white">&times;</button>
      <h3 class="text-xl font-bold text-dark dark:text-white mb-6 text-center" data-translate-key="faq">Frequently Asked Questions</h3>
      <div id="faq-accordion" class="space-y-3">
        <!-- FAQ Item 1 -->
        <div class="faq-item border-b dark:border-gray-700 pb-2">
          <button class="faq-question flex justify-between items-center w-full text-left font-semibold text-dark dark:text-white py-2">
            <span data-translate-key="faq_q1">How do I perform a search?</span>
            <i class="fas fa-chevron-down transition-transform"></i>
          </button>
          <div class="faq-answer hidden mt-2 px-2 text-gray-600 dark:text-gray-300">
            <p data-translate-key="faq_a1">After selecting a location on the first page, you can either type what you're looking for (e.g., "pizza") in the search bar or browse through the categories. Click the "Search" button to see the results.</p>
          </div>
        </div>
        <!-- FAQ Item 2 -->
        <div class="faq-item border-b dark:border-gray-700 pb-2">
          <button class="faq-question flex justify-between items-center w-full text-left font-semibold text-dark dark:text-white py-2">
            <span data-translate-key="faq_q2">Can I search in a different city?</span>
            <i class="fas fa-chevron-down transition-transform"></i>
          </button>
          <div class="faq-answer hidden mt-2 px-2 text-gray-600 dark:text-gray-300">
            <p data-translate-key="faq_a2">Yes! On the location page, either click any point on the map or use the "Select from a List" option to choose a different city before starting your search.</p>
          </div>
        </div>
        <!-- FAQ Item 3 -->
        <div class="faq-item border-b dark:border-gray-700 pb-2">
          <button class="faq-question flex justify-between items-center w-full text-left font-semibold text-dark dark:text-white py-2">
            <span data-translate-key="faq_q3">Why do some results seem far away?</span>
            <i class="fas fa-chevron-down transition-transform"></i>
          </button>
          <div class="faq-answer hidden mt-2 px-2 text-gray-600 dark:text-gray-300">
            <p data-translate-key="faq_a3">We search within a 25km radius. While results are initially sorted by distance, you can switch to the "Best" tab to see top-rated places, which might be further away.</p>
          </div>
        </div>
        <!-- FAQ Item 4 -->
        <div class="faq-item border-b dark:border-gray-700 pb-2">
          <button class="faq-question flex justify-between items-center w-full text-left font-semibold text-dark dark:text-white py-2">
            <span data-translate-key="faq_q4">Is my location data saved?</span>
            <i class="fas fa-chevron-down transition-transform"></i>
          </button>
          <div class="faq-answer hidden mt-2 px-2 text-gray-600 dark:text-gray-300">
            <p data-translate-key="faq_a4">Your privacy is our priority. Your location is only used for the current search session and is not stored on our servers.</p>
          </div>
        </div>
        <!-- FAQ Item 5 -->
        <div class="faq-item border-b dark:border-gray-700 pb-2">
          <button class="faq-question flex justify-between items-center w-full text-left font-semibold text-dark dark:text-white py-2">
            <span data-translate-key="faq_q5">What features are planned for the future?</span>
            <i class="fas fa-chevron-down transition-transform"></i>
          </button>
          <div class="faq-answer hidden mt-2 px-2 text-gray-600 dark:text-gray-300">
            <p data-translate-key="faq_a5">We're working on adding user reviews, the ability to save favorite locations, and providing more detailed place information. Stay tuned for updates!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="index.tsx"></script>
</body>

</html>